{"ast":null,"code":"class AlertManager {\n  constructor() {\n    this.audioContext = null;\n    this.oscillator = null;\n    this.gainNode = null;\n    this.settings = {\n      soundAlerts: true,\n      alertVolume: 0.5\n    };\n  }\n  async initAudio() {\n    if (this.audioContext) return;\n    try {\n      this.audioContext = new (window.AudioContext || window.webkitAudioContext)();\n\n      // 创建振荡器\n      this.oscillator = this.audioContext.createOscillator();\n      this.oscillator.type = 'sine';\n      this.oscillator.frequency.setValueAtTime(440, this.audioContext.currentTime); // 440Hz = A4音符\n\n      // 创建音量控制节点\n      this.gainNode = this.audioContext.createGain();\n      this.gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);\n\n      // 连接节点\n      this.oscillator.connect(this.gainNode);\n      this.gainNode.connect(this.audioContext.destination);\n\n      // 开始播放\n      this.oscillator.start();\n    } catch (error) {\n      console.error('Failed to initialize audio:', error);\n      this.cleanup();\n    }\n  }\n  async playSound() {\n    if (!this.settings.soundAlerts) return;\n    try {\n      await this.initAudio();\n      if (this.gainNode && this.audioContext) {\n        const now = this.audioContext.currentTime;\n\n        // 设置音量包络\n        this.gainNode.gain.cancelScheduledValues(now);\n        this.gainNode.gain.setValueAtTime(0, now);\n        this.gainNode.gain.linearRampToValueAtTime(this.settings.alertVolume, now + 0.01);\n        this.gainNode.gain.linearRampToValueAtTime(0, now + 0.5);\n      }\n    } catch (error) {\n      console.error('Failed to play alert sound:', error);\n    }\n  }\n  trigger(type) {\n    switch (type) {\n      case 'sound':\n      case 'low-volume':\n      case 'all':\n        this.playSound();\n        break;\n    }\n  }\n  updateSettings(settings) {\n    this.settings = {\n      ...this.settings,\n      ...settings\n    };\n  }\n  cleanup() {\n    if (this.oscillator) {\n      this.oscillator.stop();\n      this.oscillator.disconnect();\n    }\n    if (this.gainNode) {\n      this.gainNode.disconnect();\n    }\n    if (this.audioContext) {\n      this.audioContext.close();\n    }\n    this.oscillator = null;\n    this.gainNode = null;\n    this.audioContext = null;\n  }\n  dispose() {\n    this.cleanup();\n  }\n}\nexport const alertManager = new AlertManager();","map":{"version":3,"names":["AlertManager","constructor","audioContext","oscillator","gainNode","settings","soundAlerts","alertVolume","initAudio","window","AudioContext","webkitAudioContext","createOscillator","type","frequency","setValueAtTime","currentTime","createGain","gain","connect","destination","start","error","console","cleanup","playSound","now","cancelScheduledValues","linearRampToValueAtTime","trigger","updateSettings","stop","disconnect","close","dispose","alertManager"],"sources":["D:/projects/volume-monitor/src/utils/alertManager.ts"],"sourcesContent":["import { Settings } from '../types';\r\n\r\nclass AlertManager {\r\n  private audioContext: AudioContext | null = null;\r\n  private oscillator: OscillatorNode | null = null;\r\n  private gainNode: GainNode | null = null;\r\n  private settings: AlertSettings = {\r\n    soundAlerts: true,\r\n    alertVolume: 0.5\r\n  };\r\n\r\n  private async initAudio() {\r\n    if (this.audioContext) return;\r\n\r\n    try {\r\n      this.audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\r\n      \r\n      // 创建振荡器\r\n      this.oscillator = this.audioContext.createOscillator();\r\n      this.oscillator.type = 'sine';\r\n      this.oscillator.frequency.setValueAtTime(440, this.audioContext.currentTime); // 440Hz = A4音符\r\n      \r\n      // 创建音量控制节点\r\n      this.gainNode = this.audioContext.createGain();\r\n      this.gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);\r\n      \r\n      // 连接节点\r\n      this.oscillator.connect(this.gainNode);\r\n      this.gainNode.connect(this.audioContext.destination);\r\n      \r\n      // 开始播放\r\n      this.oscillator.start();\r\n    } catch (error) {\r\n      console.error('Failed to initialize audio:', error);\r\n      this.cleanup();\r\n    }\r\n  }\r\n\r\n  private async playSound() {\r\n    if (!this.settings.soundAlerts) return;\r\n\r\n    try {\r\n      await this.initAudio();\r\n      if (this.gainNode && this.audioContext) {\r\n        const now = this.audioContext.currentTime;\r\n        \r\n        // 设置音量包络\r\n        this.gainNode.gain.cancelScheduledValues(now);\r\n        this.gainNode.gain.setValueAtTime(0, now);\r\n        this.gainNode.gain.linearRampToValueAtTime(this.settings.alertVolume, now + 0.01);\r\n        this.gainNode.gain.linearRampToValueAtTime(0, now + 0.5);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to play alert sound:', error);\r\n    }\r\n  }\r\n\r\n  trigger(type: 'sound' | 'text' | 'visual' | 'all' | 'low-volume') {\r\n    switch (type) {\r\n      case 'sound':\r\n      case 'low-volume':\r\n      case 'all':\r\n        this.playSound();\r\n        break;\r\n    }\r\n  }\r\n\r\n  updateSettings(settings: Partial<AlertSettings>) {\r\n    this.settings = { ...this.settings, ...settings };\r\n  }\r\n\r\n  private cleanup() {\r\n    if (this.oscillator) {\r\n      this.oscillator.stop();\r\n      this.oscillator.disconnect();\r\n    }\r\n    if (this.gainNode) {\r\n      this.gainNode.disconnect();\r\n    }\r\n    if (this.audioContext) {\r\n      this.audioContext.close();\r\n    }\r\n    this.oscillator = null;\r\n    this.gainNode = null;\r\n    this.audioContext = null;\r\n  }\r\n\r\n  dispose() {\r\n    this.cleanup();\r\n  }\r\n}\r\n\r\nexport const alertManager = new AlertManager(); "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}