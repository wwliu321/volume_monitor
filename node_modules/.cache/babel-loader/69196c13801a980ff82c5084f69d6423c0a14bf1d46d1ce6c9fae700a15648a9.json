{"ast":null,"code":"/// <reference lib=\"webworker\" />\n\nfunction calculateRMSVolume(dataArray) {\n  let sum = 0;\n  for (let i = 0; i < dataArray.length; i++) {\n    sum += dataArray[i] * dataArray[i];\n  }\n  return Math.sqrt(sum / dataArray.length);\n}\nfunction convertToPercentage(rms) {\n  return Math.min(100, Math.max(0, rms * 100));\n}\n\n// 添加 TypeScript 的 Worker 上下文类型\n\nself.onmessage = e => {\n  const {\n    dataArray\n  } = e.data;\n  try {\n    const rms = calculateRMSVolume(dataArray);\n    const volume = convertToPercentage(rms);\n    self.postMessage({\n      type: 'volume',\n      data: {\n        volume,\n        raw: {\n          rms\n        }\n      }\n    });\n  } catch (error) {\n    self.postMessage({\n      type: 'error',\n      error: error instanceof Error ? error.message : 'Unknown error'\n    });\n  }\n};\nself.onerror = error => {\n  self.postMessage({\n    type: 'error',\n    error: error.message\n  });\n};\nexport {};","map":{"version":3,"names":["calculateRMSVolume","dataArray","sum","i","length","Math","sqrt","convertToPercentage","rms","min","max","self","onmessage","e","data","volume","postMessage","type","raw","error","Error","message","onerror"],"sources":["D:/projects/volume-monitor/src/workers/volumeWorker.ts"],"sourcesContent":["/// <reference lib=\"webworker\" />\r\n\r\nexport interface VolumeAnalysisConfig {\r\n  dataArray: Float32Array;\r\n  minDecibels: number;\r\n  maxDecibels: number;\r\n}\r\n\r\nfunction calculateRMSVolume(dataArray: Float32Array): number {\r\n  let sum = 0;\r\n  for (let i = 0; i < dataArray.length; i++) {\r\n    sum += dataArray[i] * dataArray[i];\r\n  }\r\n  return Math.sqrt(sum / dataArray.length);\r\n}\r\n\r\nfunction convertToPercentage(rms: number): number {\r\n  return Math.min(100, Math.max(0, rms * 100));\r\n}\r\n\r\n// 添加 TypeScript 的 Worker 上下文类型\r\ndeclare const self: DedicatedWorkerGlobalScope;\r\n\r\nself.onmessage = (e: MessageEvent<{ dataArray: Float32Array }>) => {\r\n  const { dataArray } = e.data;\r\n  \r\n  try {\r\n    const rms = calculateRMSVolume(dataArray);\r\n    const volume = convertToPercentage(rms);\r\n\r\n    self.postMessage({\r\n      type: 'volume',\r\n      data: {\r\n        volume,\r\n        raw: { rms }\r\n      }\r\n    });\r\n  } catch (error: unknown) {\r\n    self.postMessage({\r\n      type: 'error',\r\n      error: error instanceof Error ? error.message : 'Unknown error'\r\n    });\r\n  }\r\n};\r\n\r\nself.onerror = (error: ErrorEvent) => {\r\n  self.postMessage({\r\n    type: 'error',\r\n    error: error.message\r\n  });\r\n};\r\n\r\nexport {}; "],"mappings":"AAAA;;AAQA,SAASA,kBAAkBA,CAACC,SAAuB,EAAU;EAC3D,IAAIC,GAAG,GAAG,CAAC;EACX,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,SAAS,CAACG,MAAM,EAAED,CAAC,EAAE,EAAE;IACzCD,GAAG,IAAID,SAAS,CAACE,CAAC,CAAC,GAAGF,SAAS,CAACE,CAAC,CAAC;EACpC;EACA,OAAOE,IAAI,CAACC,IAAI,CAACJ,GAAG,GAAGD,SAAS,CAACG,MAAM,CAAC;AAC1C;AAEA,SAASG,mBAAmBA,CAACC,GAAW,EAAU;EAChD,OAAOH,IAAI,CAACI,GAAG,CAAC,GAAG,EAAEJ,IAAI,CAACK,GAAG,CAAC,CAAC,EAAEF,GAAG,GAAG,GAAG,CAAC,CAAC;AAC9C;;AAEA;;AAGAG,IAAI,CAACC,SAAS,GAAIC,CAA4C,IAAK;EACjE,MAAM;IAAEZ;EAAU,CAAC,GAAGY,CAAC,CAACC,IAAI;EAE5B,IAAI;IACF,MAAMN,GAAG,GAAGR,kBAAkB,CAACC,SAAS,CAAC;IACzC,MAAMc,MAAM,GAAGR,mBAAmB,CAACC,GAAG,CAAC;IAEvCG,IAAI,CAACK,WAAW,CAAC;MACfC,IAAI,EAAE,QAAQ;MACdH,IAAI,EAAE;QACJC,MAAM;QACNG,GAAG,EAAE;UAAEV;QAAI;MACb;IACF,CAAC,CAAC;EACJ,CAAC,CAAC,OAAOW,KAAc,EAAE;IACvBR,IAAI,CAACK,WAAW,CAAC;MACfC,IAAI,EAAE,OAAO;MACbE,KAAK,EAAEA,KAAK,YAAYC,KAAK,GAAGD,KAAK,CAACE,OAAO,GAAG;IAClD,CAAC,CAAC;EACJ;AACF,CAAC;AAEDV,IAAI,CAACW,OAAO,GAAIH,KAAiB,IAAK;EACpCR,IAAI,CAACK,WAAW,CAAC;IACfC,IAAI,EAAE,OAAO;IACbE,KAAK,EAAEA,KAAK,CAACE;EACf,CAAC,CAAC;AACJ,CAAC;AAED","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}