{"ast":null,"code":"import { alertSound } from './alertSound';\nclass AlertManager {\n  constructor(options) {\n    this.options = void 0;\n    this.state = void 0;\n    this.onVisualAlert = void 0;\n    this.onTextAlert = void 0;\n    const defaults = {\n      textEnabled: true,\n      soundEnabled: true,\n      minInterval: 15000,\n      silentPeriod: 5000\n    };\n    this.options = {\n      ...defaults,\n      ...options\n    };\n    this.state = {\n      lastAlertTime: 0,\n      consecutiveLowVolume: 0,\n      currentLevel: 'none'\n    };\n  }\n  setCallbacks(callbacks) {\n    this.onVisualAlert = callbacks.onVisualAlert;\n    this.onTextAlert = callbacks.onTextAlert;\n  }\n  updateOptions(newOptions) {\n    this.options = {\n      ...this.options,\n      ...newOptions\n    };\n  }\n  handleVolume(volume, threshold) {\n    var _this$onVisualAlert;\n    const now = Date.now();\n    const isLow = volume < threshold;\n\n    // 更新视觉提示\n    (_this$onVisualAlert = this.onVisualAlert) === null || _this$onVisualAlert === void 0 ? void 0 : _this$onVisualAlert.call(this, isLow);\n    if (isLow) {\n      this.state.consecutiveLowVolume++;\n\n      // 检查是否可以触发新的提示\n      if (now - this.state.lastAlertTime >= (this.options.minInterval || 0)) {\n        this.triggerAlert(volume, this.state.consecutiveLowVolume);\n        this.state.lastAlertTime = now;\n      }\n    } else {\n      this.state.consecutiveLowVolume = 0;\n      this.state.currentLevel = 'none';\n    }\n  }\n  triggerAlert(volume, consecutiveCount) {\n    let newLevel = 'none';\n    if (consecutiveCount >= 10) {\n      newLevel = 'sound';\n    } else if (consecutiveCount >= 5) {\n      newLevel = 'text';\n    } else if (consecutiveCount >= 2) {\n      newLevel = 'visual';\n    }\n    if (newLevel !== this.state.currentLevel) {\n      this.state.currentLevel = newLevel;\n      switch (newLevel) {\n        case 'sound':\n          if (this.options.soundEnabled) {\n            alertSound.playAlert(440, 200);\n            // 声音提示后也显示文字提示\n            if (this.options.textEnabled) {\n              var _this$onTextAlert;\n              (_this$onTextAlert = this.onTextAlert) === null || _this$onTextAlert === void 0 ? void 0 : _this$onTextAlert.call(this, `声音持续过低 (${volume.toFixed(1)}%)，请调整说话音量`, 'warning');\n            }\n          }\n          break;\n        case 'text':\n          if (this.options.textEnabled) {\n            var _this$onTextAlert2;\n            (_this$onTextAlert2 = this.onTextAlert) === null || _this$onTextAlert2 === void 0 ? void 0 : _this$onTextAlert2.call(this, `声音持续过低 (${volume.toFixed(1)}%)，请调整说话音量`, 'warning');\n          }\n          break;\n        case 'visual':\n          // 视觉提示已经通过 onVisualAlert 处理\n          break;\n      }\n    }\n  }\n  reset() {\n    this.state = {\n      lastAlertTime: 0,\n      consecutiveLowVolume: 0,\n      currentLevel: 'none'\n    };\n  }\n}\nexport const alertManager = new AlertManager({\n  textEnabled: true,\n  soundEnabled: true\n});","map":{"version":3,"names":["alertSound","AlertManager","constructor","options","state","onVisualAlert","onTextAlert","defaults","textEnabled","soundEnabled","minInterval","silentPeriod","lastAlertTime","consecutiveLowVolume","currentLevel","setCallbacks","callbacks","updateOptions","newOptions","handleVolume","volume","threshold","_this$onVisualAlert","now","Date","isLow","call","triggerAlert","consecutiveCount","newLevel","playAlert","_this$onTextAlert","toFixed","_this$onTextAlert2","reset","alertManager"],"sources":["D:/projects/volume-monitor/src/utils/alertManager.ts"],"sourcesContent":["import { alertSound } from './alertSound';\r\n\r\ninterface AlertOptions {\r\n  textEnabled: boolean;\r\n  soundEnabled: boolean;\r\n  minInterval?: number;  // 最小提示间隔（毫秒）\r\n  silentPeriod?: number;  // 静默期（毫秒）\r\n  threshold?: number;\r\n}\r\n\r\ninterface AlertState {\r\n  lastAlertTime: number;\r\n  consecutiveLowVolume: number;\r\n  currentLevel: 'none' | 'visual' | 'text' | 'sound';\r\n}\r\n\r\nclass AlertManager {\r\n  private options: AlertOptions;\r\n  private state: AlertState;\r\n  private onVisualAlert?: (isLow: boolean) => void;\r\n  private onTextAlert?: (message: string, type: string) => void;\r\n\r\n  constructor(options: AlertOptions) {\r\n    const defaults = {\r\n      textEnabled: true,\r\n      soundEnabled: true,\r\n      minInterval: 15000,\r\n      silentPeriod: 5000\r\n    };\r\n    \r\n    this.options = {\r\n      ...defaults,\r\n      ...options\r\n    };\r\n\r\n    this.state = {\r\n      lastAlertTime: 0,\r\n      consecutiveLowVolume: 0,\r\n      currentLevel: 'none'\r\n    };\r\n  }\r\n\r\n  public setCallbacks(callbacks: {\r\n    onVisualAlert?: (isLow: boolean) => void;\r\n    onTextAlert?: (message: string, type: string) => void;\r\n  }) {\r\n    this.onVisualAlert = callbacks.onVisualAlert;\r\n    this.onTextAlert = callbacks.onTextAlert;\r\n  }\r\n\r\n  public updateOptions(newOptions: Partial<AlertOptions>) {\r\n    this.options = { ...this.options, ...newOptions };\r\n  }\r\n\r\n  public handleVolume(volume: number, threshold: number) {\r\n    const now = Date.now();\r\n    const isLow = volume < threshold;\r\n\r\n    // 更新视觉提示\r\n    this.onVisualAlert?.(isLow);\r\n\r\n    if (isLow) {\r\n      this.state.consecutiveLowVolume++;\r\n      \r\n      // 检查是否可以触发新的提示\r\n      if (now - this.state.lastAlertTime >= (this.options.minInterval || 0)) {\r\n        this.triggerAlert(volume, this.state.consecutiveLowVolume);\r\n        this.state.lastAlertTime = now;\r\n      }\r\n    } else {\r\n      this.state.consecutiveLowVolume = 0;\r\n      this.state.currentLevel = 'none';\r\n    }\r\n  }\r\n\r\n  private triggerAlert(volume: number, consecutiveCount: number) {\r\n    let newLevel: AlertState['currentLevel'] = 'none';\r\n    \r\n    if (consecutiveCount >= 10) {\r\n      newLevel = 'sound';\r\n    } else if (consecutiveCount >= 5) {\r\n      newLevel = 'text';\r\n    } else if (consecutiveCount >= 2) {\r\n      newLevel = 'visual';\r\n    }\r\n\r\n    if (newLevel !== this.state.currentLevel) {\r\n      this.state.currentLevel = newLevel;\r\n\r\n      switch (newLevel) {\r\n        case 'sound':\r\n          if (this.options.soundEnabled) {\r\n            alertSound.playAlert(440, 200);\r\n            // 声音提示后也显示文字提示\r\n            if (this.options.textEnabled) {\r\n              this.onTextAlert?.(\r\n                `声音持续过低 (${volume.toFixed(1)}%)，请调整说话音量`,\r\n                'warning'\r\n              );\r\n            }\r\n          }\r\n          break;\r\n        \r\n        case 'text':\r\n          if (this.options.textEnabled) {\r\n            this.onTextAlert?.(\r\n              `声音持续过低 (${volume.toFixed(1)}%)，请调整说话音量`,\r\n              'warning'\r\n            );\r\n          }\r\n          break;\r\n        \r\n        case 'visual':\r\n          // 视觉提示已经通过 onVisualAlert 处理\r\n          break;\r\n      }\r\n    }\r\n  }\r\n\r\n  public reset() {\r\n    this.state = {\r\n      lastAlertTime: 0,\r\n      consecutiveLowVolume: 0,\r\n      currentLevel: 'none'\r\n    };\r\n  }\r\n}\r\n\r\nexport const alertManager = new AlertManager({\r\n  textEnabled: true,\r\n  soundEnabled: true\r\n}); "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}