{"ast":null,"code":"export class AudioContextManager {\n  constructor() {\n    this.audioContext = null;\n    this.analyserNode = null;\n    this.sourceNode = null;\n    this.mediaStream = null;\n    this.dataArray = null;\n  }\n  async startMonitoring() {\n    try {\n      if (!this.audioContext || this.audioContext.state !== 'running') {\n        this.audioContext = new (window.AudioContext || window.webkitAudioContext)();\n        await this.audioContext.resume();\n      }\n      const stream = await navigator.mediaDevices.getUserMedia({\n        audio: {\n          echoCancellation: true,\n          noiseSuppression: true,\n          autoGainControl: true\n        }\n      });\n      this.mediaStream = stream;\n      this.sourceNode = this.audioContext.createMediaStreamSource(stream);\n      this.analyserNode = this.audioContext.createAnalyser();\n      this.analyserNode.fftSize = 2048;\n      this.analyserNode.smoothingTimeConstant = 0.8;\n      this.analyserNode.minDecibels = -90;\n      this.analyserNode.maxDecibels = -10;\n      this.sourceNode.connect(this.analyserNode);\n      this.dataArray = new Float32Array(this.analyserNode.frequencyBinCount);\n      console.log('Audio monitoring started successfully');\n    } catch (error) {\n      console.error('Failed to start audio monitoring:', error);\n      throw error;\n    }\n  }\n  getVolume() {\n    if (!this.analyserNode || !this.dataArray) {\n      return 0;\n    }\n    this.analyserNode.getFloatTimeDomainData(this.dataArray);\n    let sum = 0;\n    for (let i = 0; i < this.dataArray.length; i++) {\n      sum += this.dataArray[i] * this.dataArray[i];\n    }\n    const rms = Math.sqrt(sum / this.dataArray.length);\n    return Math.min(100, Math.max(0, rms * 100));\n  }\n  stopMonitoring() {\n    if (this.mediaStream) {\n      this.mediaStream.getTracks().forEach(track => track.stop());\n    }\n    if (this.sourceNode) {\n      this.sourceNode.disconnect();\n    }\n    if (this.audioContext && this.audioContext.state !== 'closed') {\n      this.audioContext.close();\n    }\n    this.audioContext = null;\n    this.analyserNode = null;\n    this.sourceNode = null;\n    this.mediaStream = null;\n    this.dataArray = null;\n  }\n  resume() {\n    var _this$audioContext;\n    if (((_this$audioContext = this.audioContext) === null || _this$audioContext === void 0 ? void 0 : _this$audioContext.state) === 'suspended') {\n      this.audioContext.resume();\n    }\n  }\n  suspend() {\n    var _this$audioContext2;\n    if (((_this$audioContext2 = this.audioContext) === null || _this$audioContext2 === void 0 ? void 0 : _this$audioContext2.state) === 'running') {\n      this.audioContext.suspend();\n    }\n  }\n}\nexport const audioContextManager = new AudioContextManager();","map":{"version":3,"names":["AudioContextManager","constructor","audioContext","analyserNode","sourceNode","mediaStream","dataArray","startMonitoring","state","window","AudioContext","webkitAudioContext","resume","stream","navigator","mediaDevices","getUserMedia","audio","echoCancellation","noiseSuppression","autoGainControl","createMediaStreamSource","createAnalyser","fftSize","smoothingTimeConstant","minDecibels","maxDecibels","connect","Float32Array","frequencyBinCount","console","log","error","getVolume","getFloatTimeDomainData","sum","i","length","rms","Math","sqrt","min","max","stopMonitoring","getTracks","forEach","track","stop","disconnect","close","_this$audioContext","suspend","_this$audioContext2","audioContextManager"],"sources":["D:/projects/volume-monitor/src/utils/audioContext.ts"],"sourcesContent":["export class AudioContextManager {\r\n  private audioContext: AudioContext | null = null;\r\n  private analyserNode: AnalyserNode | null = null;\r\n  private sourceNode: MediaStreamAudioSourceNode | null = null;\r\n  private mediaStream: MediaStream | null = null;\r\n  private dataArray: Float32Array | null = null;\r\n\r\n  public async startMonitoring(): Promise<void> {\r\n    try {\r\n      if (!this.audioContext || this.audioContext.state !== 'running') {\r\n        this.audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\r\n        await this.audioContext.resume();\r\n      }\r\n\r\n      const stream = await navigator.mediaDevices.getUserMedia({\r\n        audio: {\r\n          echoCancellation: true,\r\n          noiseSuppression: true,\r\n          autoGainControl: true\r\n        }\r\n      });\r\n      \r\n      this.mediaStream = stream;\r\n\r\n      this.sourceNode = this.audioContext.createMediaStreamSource(stream);\r\n      this.analyserNode = this.audioContext.createAnalyser();\r\n      \r\n      this.analyserNode.fftSize = 2048;\r\n      this.analyserNode.smoothingTimeConstant = 0.8;\r\n      this.analyserNode.minDecibels = -90;\r\n      this.analyserNode.maxDecibels = -10;\r\n      \r\n      this.sourceNode.connect(this.analyserNode);\r\n      \r\n      this.dataArray = new Float32Array(this.analyserNode.frequencyBinCount);\r\n\r\n      console.log('Audio monitoring started successfully');\r\n    } catch (error: unknown) {\r\n      console.error('Failed to start audio monitoring:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  public getVolume(): number {\r\n    if (!this.analyserNode || !this.dataArray) {\r\n      return 0;\r\n    }\r\n\r\n    this.analyserNode.getFloatTimeDomainData(this.dataArray);\r\n\r\n    let sum = 0;\r\n    for (let i = 0; i < this.dataArray.length; i++) {\r\n      sum += this.dataArray[i] * this.dataArray[i];\r\n    }\r\n    const rms = Math.sqrt(sum / this.dataArray.length);\r\n\r\n    return Math.min(100, Math.max(0, rms * 100));\r\n  }\r\n\r\n  public stopMonitoring(): void {\r\n    if (this.mediaStream) {\r\n      this.mediaStream.getTracks().forEach(track => track.stop());\r\n    }\r\n\r\n    if (this.sourceNode) {\r\n      this.sourceNode.disconnect();\r\n    }\r\n\r\n    if (this.audioContext && this.audioContext.state !== 'closed') {\r\n      this.audioContext.close();\r\n    }\r\n\r\n    this.audioContext = null;\r\n    this.analyserNode = null;\r\n    this.sourceNode = null;\r\n    this.mediaStream = null;\r\n    this.dataArray = null;\r\n  }\r\n\r\n  public resume(): void {\r\n    if (this.audioContext?.state === 'suspended') {\r\n      this.audioContext.resume();\r\n    }\r\n  }\r\n\r\n  public suspend(): void {\r\n    if (this.audioContext?.state === 'running') {\r\n      this.audioContext.suspend();\r\n    }\r\n  }\r\n}\r\n\r\nexport const audioContextManager = new AudioContextManager(); "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}