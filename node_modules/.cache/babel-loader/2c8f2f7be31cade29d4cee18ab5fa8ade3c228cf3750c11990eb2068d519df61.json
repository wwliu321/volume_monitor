{"ast":null,"code":"class AlertManager {\n  constructor() {\n    this.audioContext = null;\n    this.oscillator = null;\n    this.gainNode = null;\n    this.settings = {\n      soundAlerts: true,\n      textAlerts: true,\n      alertVolume: 0.5,\n      threshold: 30,\n      lowVolumeDuration: 3000,\n      alertInterval: 15000\n    };\n  }\n  async initAudio() {\n    if (!this.audioContext) {\n      const AudioContextClass = window.AudioContext || window.webkitAudioContext;\n      this.audioContext = new AudioContextClass();\n    }\n    if (!this.oscillator) {\n      this.oscillator = this.audioContext.createOscillator();\n      this.oscillator.type = 'sine';\n      this.oscillator.frequency.setValueAtTime(440, this.audioContext.currentTime);\n      this.gainNode = this.audioContext.createGain();\n      this.gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);\n      this.oscillator.connect(this.gainNode);\n      this.gainNode.connect(this.audioContext.destination);\n      this.oscillator.start();\n    }\n    if (this.audioContext.state === 'suspended') {\n      await this.audioContext.resume();\n    }\n  }\n  async playSound() {\n    console.log('Attempting to play sound:', {\n      soundAlerts: this.settings.soundAlerts,\n      volume: this.settings.alertVolume\n    });\n    if (!this.settings.soundAlerts) {\n      console.log('Sound alerts disabled, skipping playback');\n      return;\n    }\n    try {\n      await this.initAudio();\n      if (this.gainNode && this.audioContext) {\n        const now = this.audioContext.currentTime;\n        const volume = this.settings.alertVolume;\n        if (this.audioContext.state === 'suspended') {\n          await this.audioContext.resume();\n        }\n        this.gainNode.gain.cancelScheduledValues(now);\n        this.gainNode.gain.setValueAtTime(0, now);\n        this.gainNode.gain.linearRampToValueAtTime(volume, now + 0.05);\n        this.gainNode.gain.linearRampToValueAtTime(0, now + 0.5);\n        console.log('Sound played successfully with volume:', volume);\n      }\n    } catch (error) {\n      console.error('Failed to play alert sound:', error);\n    }\n  }\n  trigger(type) {\n    console.log('Alert triggered:', {\n      type,\n      settings: this.settings,\n      currentTime: Date.now()\n    });\n    if (type === 'low-volume' && this.settings.soundAlerts) {\n      this.playSound().catch(console.error);\n    }\n  }\n  updateConfig(newConfig) {\n    this.settings = {\n      ...this.settings,\n      ...newConfig\n    };\n    console.log('Alert manager settings updated:', this.settings);\n  }\n  getSettings() {\n    return {\n      ...this.settings\n    };\n  }\n  cleanup() {\n    if (this.oscillator) {\n      this.oscillator.stop();\n      this.oscillator.disconnect();\n    }\n    if (this.gainNode) {\n      this.gainNode.disconnect();\n    }\n    if (this.audioContext) {\n      this.audioContext.close();\n    }\n    this.oscillator = null;\n    this.gainNode = null;\n    this.audioContext = null;\n  }\n  dispose() {\n    this.cleanup();\n  }\n}\nexport const alertManager = new AlertManager();","map":{"version":3,"names":["AlertManager","constructor","audioContext","oscillator","gainNode","settings","soundAlerts","textAlerts","alertVolume","threshold","lowVolumeDuration","alertInterval","initAudio","AudioContextClass","window","AudioContext","webkitAudioContext","createOscillator","type","frequency","setValueAtTime","currentTime","createGain","gain","connect","destination","start","state","resume","playSound","console","log","volume","now","cancelScheduledValues","linearRampToValueAtTime","error","trigger","Date","catch","updateConfig","newConfig","getSettings","cleanup","stop","disconnect","close","dispose","alertManager"],"sources":["D:/projects/volume-monitor/src/utils/alertManager.ts"],"sourcesContent":["import { Settings } from '../types';\r\n\r\ninterface AlertSettings {\r\n  soundAlerts: boolean;\r\n  textAlerts: boolean;\r\n  alertVolume: number;\r\n  threshold: number;\r\n  lowVolumeDuration: number;\r\n  alertInterval: number;\r\n}\r\n\r\ninterface Window {\r\n  webkitAudioContext: typeof AudioContext;\r\n}\r\n\r\nclass AlertManager {\r\n  private audioContext: AudioContext | null = null;\r\n  private oscillator: OscillatorNode | null = null;\r\n  private gainNode: GainNode | null = null;\r\n  private settings: AlertSettings = {\r\n    soundAlerts: true,\r\n    textAlerts: true,\r\n    alertVolume: 0.5,\r\n    threshold: 30,\r\n    lowVolumeDuration: 3000,\r\n    alertInterval: 15000\r\n  };\r\n\r\n  private async initAudio() {\r\n    if (!this.audioContext) {\r\n      const AudioContextClass = (window.AudioContext || (window as any).webkitAudioContext);\r\n      this.audioContext = new AudioContextClass();\r\n    }\r\n\r\n    if (!this.oscillator) {\r\n      this.oscillator = this.audioContext.createOscillator();\r\n      this.oscillator.type = 'sine';\r\n      this.oscillator.frequency.setValueAtTime(440, this.audioContext.currentTime);\r\n      \r\n      this.gainNode = this.audioContext.createGain();\r\n      this.gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);\r\n      \r\n      this.oscillator.connect(this.gainNode);\r\n      this.gainNode.connect(this.audioContext.destination);\r\n      \r\n      this.oscillator.start();\r\n    }\r\n\r\n    if (this.audioContext.state === 'suspended') {\r\n      await this.audioContext.resume();\r\n    }\r\n  }\r\n\r\n  private async playSound() {\r\n    console.log('Attempting to play sound:', {\r\n      soundAlerts: this.settings.soundAlerts,\r\n      volume: this.settings.alertVolume\r\n    });\r\n\r\n    if (!this.settings.soundAlerts) {\r\n      console.log('Sound alerts disabled, skipping playback');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await this.initAudio();\r\n      if (this.gainNode && this.audioContext) {\r\n        const now = this.audioContext.currentTime;\r\n        const volume = this.settings.alertVolume;\r\n        \r\n        if (this.audioContext.state === 'suspended') {\r\n          await this.audioContext.resume();\r\n        }\r\n        \r\n        this.gainNode.gain.cancelScheduledValues(now);\r\n        this.gainNode.gain.setValueAtTime(0, now);\r\n        this.gainNode.gain.linearRampToValueAtTime(volume, now + 0.05);\r\n        this.gainNode.gain.linearRampToValueAtTime(0, now + 0.5);\r\n\r\n        console.log('Sound played successfully with volume:', volume);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to play alert sound:', error);\r\n    }\r\n  }\r\n\r\n  public trigger(type: string) {\r\n    console.log('Alert triggered:', {\r\n      type,\r\n      settings: this.settings,\r\n      currentTime: Date.now()\r\n    });\r\n\r\n    if (type === 'low-volume' && this.settings.soundAlerts) {\r\n      this.playSound().catch(console.error);\r\n    }\r\n  }\r\n\r\n  updateConfig(newConfig: Partial<AlertSettings>) {\r\n    this.settings = {\r\n      ...this.settings,\r\n      ...newConfig\r\n    };\r\n    console.log('Alert manager settings updated:', this.settings);\r\n  }\r\n\r\n  getSettings(): AlertSettings {\r\n    return { ...this.settings };\r\n  }\r\n\r\n  private cleanup() {\r\n    if (this.oscillator) {\r\n      this.oscillator.stop();\r\n      this.oscillator.disconnect();\r\n    }\r\n    if (this.gainNode) {\r\n      this.gainNode.disconnect();\r\n    }\r\n    if (this.audioContext) {\r\n      this.audioContext.close();\r\n    }\r\n    this.oscillator = null;\r\n    this.gainNode = null;\r\n    this.audioContext = null;\r\n  }\r\n\r\n  dispose() {\r\n    this.cleanup();\r\n  }\r\n}\r\n\r\nexport const alertManager = new AlertManager(); "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}